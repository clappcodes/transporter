var __defProp = Object.defineProperty;
var __name = (target, value) => __defProp(target, "name", { value, configurable: true });
import { readable, transform } from "../mod.ts";
import {
  STREAM_ID_KEY,
  STREAM_TYPE,
  STREAM_TYPE_KEY
} from "../transport/handle.ts";
import "./api.util.ts";
class XResponse extends Response {
  static {
    __name(this, "XResponse");
  }
  constructor(body, init) {
    super(
      readable.from(body).pipeThrough(
        transform.toUint8Array()
      ),
      init
    );
  }
  [Symbol.for("Deno.customInspect")](inspect) {
    const { body, headers } = this;
    return `${this.constructor.name} ${inspect({ body, headers })}`;
  }
}
new XResponse(function* () {
  yield 123;
});
class XRequest extends Request {
  static {
    __name(this, "XRequest");
  }
  get duplex() {
    return this.#duplex;
  }
  // get requireFullDuplex() {
  //   return this.#requireFullDuplex;
  // }
  #requireFullDuplex = false;
  #duplex = void 0;
  constructor(method, input, init) {
    const _isBrowser = Reflect.has(globalThis, "document");
    const _isDeno = Reflect.has(globalThis, "Deno");
    const _isBun = Reflect.has(globalThis, "Bun");
    const isStreamingBodyRequest = init?.body instanceof ReadableStream && method !== "GET" && method !== "HEAD";
    if (isStreamingBodyRequest) {
      if (_isDeno) {
        Object.assign(init, { duplex: "full" });
      } else {
        Object.assign(init, { duplex: "half" });
      }
    }
    super(input, { ...init, method: method === "*" ? void 0 : method });
    this.#duplex = init?.duplex;
    if (this.#duplex === "half") {
      this.headers.set(STREAM_ID_KEY, Math.random().toString().slice(2));
      this.headers.set(STREAM_TYPE_KEY, STREAM_TYPE.REQUEST);
      this[STREAM_TYPE_KEY] = STREAM_TYPE.REQUEST;
    } else {
      if (this.headers.has(STREAM_ID_KEY)) {
        if (this.headers.get(STREAM_TYPE_KEY) === STREAM_TYPE.REQUEST) {
          this.headers.set(STREAM_TYPE_KEY, STREAM_TYPE.RESPONSE);
          this[STREAM_TYPE_KEY] = STREAM_TYPE.RESPONSE;
        }
      }
    }
  }
}
function createRequest(method, input, init) {
  return new XRequest(method, input, init);
}
__name(createRequest, "createRequest");
function create(method, base2) {
  const fn = /* @__PURE__ */ __name((input, init) => {
    const url = base2 && typeof input === "string" ? new URL(input, base2).href : String(input || "/");
    return createRequest(
      method,
      url,
      init
    );
  }, "fn");
  Object.defineProperty(fn, "name", {
    value: method.toLowerCase()
  });
  Object.defineProperty(fn, "toString", {
    value: () => `${method.toLowerCase()}(input: XRequestInput, init?: XRequestInit): Response`
  });
  return fn;
}
__name(create, "create");
function base(input) {
  return {
    get: create("GET", input),
    put: create("PUT", input),
    post: create("POST", input),
    head: create("HEAD", input),
    patch: create("PATCH", input),
    delete: create("DELETE", input),
    options: create("OPTIONS", input)
  };
}
__name(base, "base");
const baseURL = typeof location === "undefined" ? "https://localhost:5050" : location.href;
const api = base(baseURL);
var api_default = api;
function xfetch(input, init) {
  const fetch = xfetch.fetch || globalThis.fetch;
  const request = input instanceof XRequest ? input : ((base2) => {
    const url = base2 && typeof input === "string" ? String(new URL(input, base2)) : String(input || "/");
    return createRequest(init?.method, url, init);
  })(baseURL);
  if (request.duplex === "half") {
    console.log("(requireFullDuplex)");
    fetch(request, {
      headers: {
        ...Object.fromEntries(request.headers.entries()),
        [STREAM_TYPE_KEY]: STREAM_TYPE.REQUEST
      }
    });
    return fetch(
      new XRequest(request.method, request.url, {
        headers: {
          ...Object.fromEntries(request.headers.entries()),
          [STREAM_TYPE_KEY]: STREAM_TYPE.RESPONSE
        }
      })
    );
  } else {
    console.log("(FullDuplex Supported)");
    return fetch(request);
  }
}
__name(xfetch, "xfetch");
export {
  XRequest,
  XResponse,
  api,
  base,
  baseURL,
  create,
  createRequest,
  api_default as default,
  xfetch
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vYXBwL2FwaS50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiLy8gZGVuby1saW50LWlnbm9yZS1maWxlIG5vLWV4cGxpY2l0LWFueVxuaW1wb3J0IHsgcmVhZGFibGUsIHRyYW5zZm9ybSB9IGZyb20gXCIuLi9tb2QudHNcIjtcbmltcG9ydCB7XG4gIFNUUkVBTV9JRF9LRVksXG4gIFNUUkVBTV9UWVBFLFxuICBTVFJFQU1fVFlQRV9LRVksXG59IGZyb20gXCIuLi90cmFuc3BvcnQvaGFuZGxlLnRzXCI7XG5pbXBvcnQgeyBSZXF1ZXN0TWV0aG9kIH0gZnJvbSBcIi4uL3R5cGVzLnRzXCI7XG5pbXBvcnQge1xuICBDb250ZXh0LFxuICBSZXF1ZXN0SGFuZGxlckZldGNoLFxuICBSZXF1ZXN0SGFuZGxlclJvdXRlLFxufSBmcm9tIFwiLi9zYW1wbGUyLnRzXCI7XG5pbXBvcnQgeyBSZXF1ZXN0SGFuZGxlckluaXQgfSBmcm9tIFwiLi9zYW1wbGUyLnRzXCI7XG5pbXBvcnQgeyBSZXF1ZXN0SGFuZGxlciB9IGZyb20gXCIuL3NhbXBsZTIudHNcIjtcbmltcG9ydCBcIi4vYXBpLnV0aWwudHNcIjtcbmltcG9ydCB7IFJlYWRhYmxlU3RyZWFtRnJvbSB9IGZyb20gXCIuLi9zaGltcy50c1wiO1xuXG5leHBvcnQgdHlwZSBVUkxTdHJpbmc8VT4gPSBVIGV4dGVuZHMgUmVxdWVzdCA/IFVbXCJ1cmxcIl1cbiAgOiBVIGV4dGVuZHMgVVJMID8gVVtcImhyZWZcIl1cbiAgOiBVO1xuXG5leHBvcnQgdHlwZSBBYnNvbHV0ZVVSTDxVIGV4dGVuZHMgc3RyaW5nLCBCIGV4dGVuZHMgc3RyaW5nPiA9IEIgZXh0ZW5kc1xuICB1bmRlZmluZWQgPyBVXG4gIDogYCR7Qn0ke1V9YDtcblxuZXhwb3J0IHR5cGUgWFJlcXVlc3RNZXRob2QgPVxuICB8IFwiKlwiXG4gIHwgXCJPUFRJT05TXCJcbiAgfCBcIkhFQURcIlxuICB8IFwiUE9TVFwiXG4gIHwgXCJHRVRcIlxuICB8IFwiUFVUXCJcbiAgfCBcIlBBVENIXCJcbiAgfCBcIkRFTEVURVwiO1xuXG5leHBvcnQgdHlwZSBYUmVxdWVzdFVSTDxVIGV4dGVuZHMgWFJlcXVlc3RJbnB1dCwgQiBleHRlbmRzIHN0cmluZz4gPVxuICBBYnNvbHV0ZVVSTDxcbiAgICBVUkxTdHJpbmc8VT4sXG4gICAgQlxuICA+O1xuXG50eXBlIFhSZXF1ZXN0SW5pdCA9IE9taXQ8UmVxdWVzdEluaXQsIFwibWV0aG9kXCI+O1xudHlwZSBYUmVxdWVzdElucHV0ID0gUmVxdWVzdEluZm8gfCBVUkw7XG5cbmV4cG9ydCBjbGFzcyBYUmVzcG9uc2U8XG4gIFggZXh0ZW5kcyAoKCkgPT4gYW55KSB8IEJvZHlJbml0IHwgbnVsbCxcbiAgSSBleHRlbmRzIFJlc3BvbnNlSW5pdCxcbj4gZXh0ZW5kcyBSZXNwb25zZSB7XG4gIGNvbnN0cnVjdG9yKGJvZHk6IFgsIGluaXQ/OiBJKSB7XG4gICAgc3VwZXIoXG4gICAgICByZWFkYWJsZS5mcm9tKGJvZHkpLnBpcGVUaHJvdWdoKFxuICAgICAgICB0cmFuc2Zvcm0udG9VaW50OEFycmF5KCksXG4gICAgICApLFxuICAgICAgaW5pdCxcbiAgICApO1xuICB9XG4gIFtTeW1ib2wuZm9yKFwiRGVuby5jdXN0b21JbnNwZWN0XCIpXShcbiAgICBpbnNwZWN0OiAodmFsdWU6IHVua25vd24pID0+IHN0cmluZyxcbiAgKTogc3RyaW5nIHtcbiAgICBjb25zdCB7IGJvZHksIGhlYWRlcnMgfSA9IHRoaXM7XG4gICAgcmV0dXJuIGAke3RoaXMuY29uc3RydWN0b3IubmFtZX0gJHtpbnNwZWN0KHsgYm9keSwgaGVhZGVycyB9KX1gO1xuICB9XG59XG5cbm5ldyBYUmVzcG9uc2UoZnVuY3Rpb24qICgpIHtcbiAgeWllbGQgMTIzO1xufSk7XG5cbmV4cG9ydCBjbGFzcyBYUmVxdWVzdDxcbiAgTSBleHRlbmRzIFhSZXF1ZXN0TWV0aG9kLFxuICBVIGV4dGVuZHMgWFJlcXVlc3RJbnB1dCxcbiAgSSBleHRlbmRzIFhSZXF1ZXN0SW5pdCxcbj4gZXh0ZW5kcyBSZXF1ZXN0IHtcbiAgZGVjbGFyZSB1cmw6IFVSTFN0cmluZzxVPjtcbiAgZGVjbGFyZSBtZXRob2Q6IE07XG4gIGRlY2xhcmUgYm9keTogSVtcImJvZHlcIl0gZXh0ZW5kcyBSZWFkYWJsZVN0cmVhbSA/IElbXCJib2R5XCJdIDogbnVsbDtcbiAgZGVjbGFyZSBbU1RSRUFNX1RZUEVfS0VZXTogU1RSRUFNX1RZUEU7XG5cbiAgZ2V0IGR1cGxleCgpIHtcbiAgICByZXR1cm4gdGhpcy4jZHVwbGV4O1xuICB9XG5cbiAgLy8gZ2V0IHJlcXVpcmVGdWxsRHVwbGV4KCkge1xuICAvLyAgIHJldHVybiB0aGlzLiNyZXF1aXJlRnVsbER1cGxleDtcbiAgLy8gfVxuXG4gICNyZXF1aXJlRnVsbER1cGxleDogYm9vbGVhbiA9IGZhbHNlO1xuICAjZHVwbGV4OiBcImhhbGZcIiB8IFwiZnVsbFwiIHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkO1xuXG4gIGNvbnN0cnVjdG9yKG1ldGhvZDogTSwgaW5wdXQ6IFUsIGluaXQ/OiBJKSB7XG4gICAgLy8gbGV0IHJlcXVpcmVGdWxsRHVwbGV4ID0gZmFsc2U7XG4gICAgY29uc3QgX2lzQnJvd3NlciA9IFJlZmxlY3QuaGFzKGdsb2JhbFRoaXMsIFwiZG9jdW1lbnRcIik7XG4gICAgY29uc3QgX2lzRGVubyA9IFJlZmxlY3QuaGFzKGdsb2JhbFRoaXMsIFwiRGVub1wiKTtcbiAgICBjb25zdCBfaXNCdW4gPSBSZWZsZWN0LmhhcyhnbG9iYWxUaGlzLCBcIkJ1blwiKTtcbiAgICBjb25zdCBpc1N0cmVhbWluZ0JvZHlSZXF1ZXN0ID0gaW5pdD8uYm9keSBpbnN0YW5jZW9mIFJlYWRhYmxlU3RyZWFtICYmXG4gICAgICBtZXRob2QgIT09IFwiR0VUXCIgJiYgbWV0aG9kICE9PSBcIkhFQURcIjtcblxuICAgIGlmIChpc1N0cmVhbWluZ0JvZHlSZXF1ZXN0KSB7XG4gICAgICBpZiAoX2lzRGVubykge1xuICAgICAgICBPYmplY3QuYXNzaWduKGluaXQsIHsgZHVwbGV4OiBcImZ1bGxcIiB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIE9iamVjdC5hc3NpZ24oaW5pdCwgeyBkdXBsZXg6IFwiaGFsZlwiIH0pO1xuICAgICAgfVxuICAgICAgLy8gcmVxdWlyZUZ1bGxEdXBsZXggPSB0cnVlO1xuICAgIH1cblxuICAgIHN1cGVyKGlucHV0LCB7IC4uLmluaXQsIG1ldGhvZDogbWV0aG9kID09PSBcIipcIiA/IHVuZGVmaW5lZCA6IG1ldGhvZCB9KTtcblxuICAgIC8vIEB0cy1pZ25vcmUgLlxuICAgIHRoaXMuI2R1cGxleCA9IGluaXQ/LmR1cGxleDtcbiAgICAvLyB0aGlzLiNyZXF1aXJlRnVsbER1cGxleCA9IHJlcXVpcmVGdWxsRHVwbGV4O1xuXG4gICAgaWYgKHRoaXMuI2R1cGxleCA9PT0gXCJoYWxmXCIpIHtcbiAgICAgIHRoaXMuaGVhZGVycy5zZXQoU1RSRUFNX0lEX0tFWSwgTWF0aC5yYW5kb20oKS50b1N0cmluZygpLnNsaWNlKDIpKTtcbiAgICAgIHRoaXMuaGVhZGVycy5zZXQoU1RSRUFNX1RZUEVfS0VZLCBTVFJFQU1fVFlQRS5SRVFVRVNUKTtcbiAgICAgIHRoaXNbU1RSRUFNX1RZUEVfS0VZXSA9IFNUUkVBTV9UWVBFLlJFUVVFU1Q7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh0aGlzLmhlYWRlcnMuaGFzKFNUUkVBTV9JRF9LRVkpKSB7XG4gICAgICAgIGlmICh0aGlzLmhlYWRlcnMuZ2V0KFNUUkVBTV9UWVBFX0tFWSkgPT09IFNUUkVBTV9UWVBFLlJFUVVFU1QpIHtcbiAgICAgICAgICB0aGlzLmhlYWRlcnMuc2V0KFNUUkVBTV9UWVBFX0tFWSwgU1RSRUFNX1RZUEUuUkVTUE9OU0UpO1xuICAgICAgICAgIHRoaXNbU1RSRUFNX1RZUEVfS0VZXSA9IFNUUkVBTV9UWVBFLlJFU1BPTlNFO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVSZXF1ZXN0PFxuICBNIGV4dGVuZHMgWFJlcXVlc3RNZXRob2QsXG4gIFUgZXh0ZW5kcyBYUmVxdWVzdElucHV0LFxuICBJIGV4dGVuZHMgWFJlcXVlc3RJbml0LFxuPihcbiAgbWV0aG9kOiBNLFxuICBpbnB1dDogVSxcbiAgaW5pdD86IEksXG4pIHtcbiAgcmV0dXJuIG5ldyBYUmVxdWVzdChtZXRob2QsIGlucHV0LCBpbml0KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZTxNIGV4dGVuZHMgWFJlcXVlc3RNZXRob2QsIEIgZXh0ZW5kcyBzdHJpbmc+KFxuICBtZXRob2Q6IE0sXG4gIGJhc2U/OiBCLFxuKSB7XG4gIGNvbnN0IGZuID0gPFxuICAgIFUgZXh0ZW5kcyBYUmVxdWVzdElucHV0LFxuICAgIEkgZXh0ZW5kcyBYUmVxdWVzdEluaXQsXG4gICAgUyBleHRlbmRzIFhSZXF1ZXN0VVJMPFUsIEI+LFxuICA+KFxuICAgIGlucHV0OiBVLFxuICAgIGluaXQ/OiBJLFxuICApID0+IHtcbiAgICBjb25zdCB1cmwgPVxuICAgICAgKGJhc2UgJiYgdHlwZW9mIGlucHV0ID09PSBcInN0cmluZ1wiXG4gICAgICAgID8gbmV3IFVSTChpbnB1dCwgYmFzZSkuaHJlZlxuICAgICAgICA6IFN0cmluZyhpbnB1dCB8fCBcIi9cIikpIGFzIFM7XG5cbiAgICByZXR1cm4gY3JlYXRlUmVxdWVzdChcbiAgICAgIG1ldGhvZCxcbiAgICAgIHVybCxcbiAgICAgIGluaXQsXG4gICAgKTtcbiAgfTtcblxuICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZm4sIFwibmFtZVwiLCB7XG4gICAgdmFsdWU6IG1ldGhvZC50b0xvd2VyQ2FzZSgpLFxuICB9KTtcblxuICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZm4sIFwidG9TdHJpbmdcIiwge1xuICAgIHZhbHVlOiAoKSA9PlxuICAgICAgYCR7bWV0aG9kLnRvTG93ZXJDYXNlKCl9KGlucHV0OiBYUmVxdWVzdElucHV0LCBpbml0PzogWFJlcXVlc3RJbml0KTogUmVzcG9uc2VgLFxuICB9KTtcblxuICByZXR1cm4gZm47XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBiYXNlPFUgZXh0ZW5kcyBzdHJpbmc+KGlucHV0PzogVSkge1xuICByZXR1cm4ge1xuICAgIGdldDogY3JlYXRlKFwiR0VUXCIsIGlucHV0KSxcbiAgICBwdXQ6IGNyZWF0ZShcIlBVVFwiLCBpbnB1dCksXG4gICAgcG9zdDogY3JlYXRlKFwiUE9TVFwiLCBpbnB1dCksXG4gICAgaGVhZDogY3JlYXRlKFwiSEVBRFwiLCBpbnB1dCksXG4gICAgcGF0Y2g6IGNyZWF0ZShcIlBBVENIXCIsIGlucHV0KSxcbiAgICBkZWxldGU6IGNyZWF0ZShcIkRFTEVURVwiLCBpbnB1dCksXG4gICAgb3B0aW9uczogY3JlYXRlKFwiT1BUSU9OU1wiLCBpbnB1dCksXG4gIH07XG59XG5cbmV4cG9ydCBjb25zdCBiYXNlVVJMID0gdHlwZW9mIGxvY2F0aW9uID09PSBcInVuZGVmaW5lZFwiXG4gID8gXCJodHRwczovL2xvY2FsaG9zdDo1MDUwXCJcbiAgOiBsb2NhdGlvbi5ocmVmIGFzIHVua25vd24gYXMgdW5kZWZpbmVkO1xuXG5leHBvcnQgY29uc3QgYXBpID0gYmFzZShiYXNlVVJMKTtcblxuZXhwb3J0IGRlZmF1bHQgYXBpO1xuXG4vLyBleHBvcnQgZnVuY3Rpb24gaGFuZGxlPFQgZXh0ZW5kcyBYUmVxdWVzdDxhbnksIGFueSwgYW55Pj4oXG4vLyAgIHJlcXVlc3Q6IFQsXG4vLyAgIGZldGNoOiBSZXF1ZXN0SGFuZGxlckZldGNoIC8vIChyZXF1ZXN0OiBUKSA9PiBSZXNwb25zZSxcbi8vICAgLFxuLy8gKSB7XG4vLyAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoZmV0Y2gocmVxdWVzdCwgbmV3IENvbnRleHQocmVxdWVzdCkpKS50aGVuKFxuLy8gICAgIChyZXNwb25zZSkgPT4ge1xuLy8gICAgICAgaWYgKHJlc3BvbnNlIGluc3RhbmNlb2YgUmVzcG9uc2UpIHtcbi8vICAgICAgICAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShyZXNwb25zZSwgXCJ1cmxcIiwge1xuLy8gICAgICAgICAgIGdldDogKCkgPT4gcmVxdWVzdC51cmwsXG4vLyAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4vLyAgICAgICAgIH0pO1xuLy8gICAgICAgfVxuLy8gICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuLy8gICAgIH0sXG4vLyAgICk7XG4vLyB9XG5cbmV4cG9ydCBmdW5jdGlvbiB4ZmV0Y2goXG4gIGlucHV0OlxuICAgIHwgc3RyaW5nXG4gICAgfCBYUmVxdWVzdDxYUmVxdWVzdE1ldGhvZCwgWFJlcXVlc3RJbnB1dCwgWFJlcXVlc3RJbml0PlxuICAgIHwgUmVxdWVzdFxuICAgIHwgVVJMLFxuICBpbml0PzogUmVxdWVzdEluaXQsXG4pOiBQcm9taXNlPFJlc3BvbnNlPiB7XG4gIC8vIEB0cy1pZ25vcmUgLlxuICBjb25zdCBmZXRjaCA9IHhmZXRjaC5mZXRjaCBhcyB0eXBlb2YgZ2xvYmFsVGhpcy5mZXRjaCB8fCBnbG9iYWxUaGlzLmZldGNoO1xuXG4gIGNvbnN0IHJlcXVlc3QgPSBpbnB1dCBpbnN0YW5jZW9mIFhSZXF1ZXN0ID8gaW5wdXQgOiAoKGJhc2U/OiBzdHJpbmcpID0+IHtcbiAgICBjb25zdCB1cmwgPSBiYXNlICYmIHR5cGVvZiBpbnB1dCA9PT0gXCJzdHJpbmdcIlxuICAgICAgPyBTdHJpbmcobmV3IFVSTChpbnB1dCwgYmFzZSkpXG4gICAgICA6IFN0cmluZyhpbnB1dCB8fCBcIi9cIik7XG5cbiAgICByZXR1cm4gY3JlYXRlUmVxdWVzdChpbml0Py5tZXRob2QgYXMgWFJlcXVlc3RNZXRob2QsIHVybCwgaW5pdCk7XG4gIH0pKGJhc2VVUkwpO1xuXG4gIGlmIChyZXF1ZXN0LmR1cGxleCA9PT0gXCJoYWxmXCIpIHtcbiAgICBjb25zb2xlLmxvZyhcIihyZXF1aXJlRnVsbER1cGxleClcIik7XG5cbiAgICBmZXRjaChyZXF1ZXN0LCB7XG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIC4uLk9iamVjdC5mcm9tRW50cmllcyhyZXF1ZXN0LmhlYWRlcnMuZW50cmllcygpKSxcbiAgICAgICAgW1NUUkVBTV9UWVBFX0tFWV06IFNUUkVBTV9UWVBFLlJFUVVFU1QsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIGZldGNoKFxuICAgICAgbmV3IFhSZXF1ZXN0KHJlcXVlc3QubWV0aG9kLCByZXF1ZXN0LnVybCwge1xuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgLi4uT2JqZWN0LmZyb21FbnRyaWVzKHJlcXVlc3QuaGVhZGVycy5lbnRyaWVzKCkpLFxuICAgICAgICAgIFtTVFJFQU1fVFlQRV9LRVldOiBTVFJFQU1fVFlQRS5SRVNQT05TRSxcbiAgICAgICAgfSxcbiAgICAgIH0pLFxuICAgICk7XG4gIH0gZWxzZSB7XG4gICAgY29uc29sZS5sb2coXCIoRnVsbER1cGxleCBTdXBwb3J0ZWQpXCIpO1xuXG4gICAgcmV0dXJuIGZldGNoKHJlcXVlc3QpO1xuICB9XG59XG5cbi8vIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgaGFuZGxlKFxuLy8gICBhcGkucG9zdChcIi9lY2hvb1wiLCB7IGJvZHk6IHJlYWRhYmxlLmZyb20oXCJIZWxsbyBXb3JsZCFcIikgfSksXG4vLyAgIChyZXEpID0+IG5ldyBSZXNwb25zZShyZXEuYm9keSksXG4vLyApO1xuXG4vLyBleHBvcnQgZnVuY3Rpb24gaGFuZGxlckJhc2U8QiBleHRlbmRzIHN0cmluZz4oYmFzZVVSTD86IEIpIHtcbi8vICAgcmV0dXJuIDxcbi8vICAgICBNIGV4dGVuZHMgUmVxdWVzdE1ldGhvZCxcbi8vICAgICBQIGV4dGVuZHMgc3RyaW5nLFxuLy8gICAgIEYgZXh0ZW5kcyBSZXF1ZXN0SGFuZGxlckZldGNoLFxuLy8gICA+KFxuLy8gICAgIG1ldGhvZDogTSxcbi8vICAgICBwYXRobmFtZTogUCxcbi8vICAgICBmZXRjaDogRixcbi8vICAgKSA9PiB7XG4vLyAgICAgcmV0dXJuIG5ldyBSZXF1ZXN0SGFuZGxlcih7XG4vLyAgICAgICBiYXNlVVJMOiBiYXNlVVJMISxcbi8vICAgICAgIG1ldGhvZCxcbi8vICAgICAgIHBhdGhuYW1lLFxuLy8gICAgIH0sIGZldGNoKTtcbi8vICAgfTtcbi8vIH1cblxuLy8gY29uc3QgZGVmaW5lSGFuZGxlciA9IGhhbmRsZXJCYXNlKGJhc2VVUkwpO1xuXG4vLyBleHBvcnQgY29uc3QgaGFuZGxlciA9IGRlZmluZUhhbmRsZXIoXG4vLyAgIFwiR0VUXCIsXG4vLyAgIFwiL2VjaG9cIixcbi8vICAgKHJlcSkgPT4gbmV3IFJlc3BvbnNlKHJlcS5ib2R5KSxcbi8vICk7XG5cbi8vIGZ1bmN0aW9uIGNyZWF0ZUhhbmRsZXJNZXRob2Q8XG4vLyAgIE0gZXh0ZW5kcyBSZXF1ZXN0TWV0aG9kLFxuLy8gICBQIGV4dGVuZHMgc3RyaW5nLFxuLy8gICBIIGV4dGVuZHMgUmVxdWVzdEhhbmRsZXJGZXRjaCxcbi8vID4obWV0aG9kOiBNLCBwYXRobmFtZTogUCwgaGFuZGxlcjogSCkge1xuLy8gICBmdW5jdGlvbiBmbigpIHtcbi8vICAgICByZXR1cm47XG4vLyAgIH1cbi8vIH1cblxuLy8gY29uc3QgX3JlcXVlc3QgPSBhcGkucG9zdChcIi9lY2hvXCIsIHtcbi8vICAgYm9keTogcmVhZGFibGUuZnJvbShcIkhlbGxvIFdvcmxkIVwiKS5waXBlVGhyb3VnaCh0cmFuc2Zvcm0uZW5jb2RlKCkpLFxuLy8gfSk7XG5cbi8vIGNvbnN0IHJlcyA9IGF3YWl0IGhhbmRsZShfcmVxdWVzdCwgaGFuZGxlci5mZXRjaCk7XG5cbi8vIHJlYWRhYmxlLnJlYWQoY29uc29sZS5sb2cpKHJlcy5ib2R5ISk7XG5cbi8vIGNvbnN0IGZvb0hhbmRsZXIgPSAocmVxOiBSZXF1ZXN0LCBjdHg6IENvbnRleHQpID0+IG5ldyBSZXNwb25zZShyZXEuYm9keSk7XG5cbi8vIHR5cGUgUkhhbmRsZXIgPSAocmVxOiBSZXF1ZXN0LCBjdHg6IENvbnRleHQpID0+IFJlc3BvbnNlIHwgdW5kZWZpbmVkO1xuXG4vLyBmdW5jdGlvbiBkZWZpbmU8RiBleHRlbmRzICguLi5hcmdzOiBhbnlbXSkgPT4gKGhhbmRsZXI6IFJIYW5kbGVyKSA9PiBSSGFuZGxlcj4oXG4vLyAgIGZuOiBGLFxuLy8gKSB7XG4vLyAgIHJldHVybiBmbjtcbi8vIH1cblxuLy8gY29uc3QgcGF0dGVybiA9IGRlZmluZShmdW5jdGlvbiByb3V0ZShpbnB1dDogVVJMUGF0dGVybklucHV0KSB7XG4vLyAgIHJldHVybiAoaGFuZGxlcikgPT4gKHJlcSwgY3R4KSA9PlxuLy8gICAgIG5ldyBVUkxQYXR0ZXJuKGlucHV0KS50ZXN0KHJlcS51cmwpID8gaGFuZGxlcihyZXEsIGN0eCkgOiB1bmRlZmluZWQ7XG4vLyB9KTtcblxuLy8gY29uc3QgbWV0aG9kID0gPFQgZXh0ZW5kcyBSZXF1ZXN0TWV0aG9kPihcbi8vICAgbWV0aG9kOiBULFxuLy8gKSA9PiB7XG4vLyAgIHJldHVybiA8WCA9IFQ+KGhhbmRsZXI6IFJIYW5kbGVyKTogUkhhbmRsZXIgPT4ge1xuLy8gICAgIHJldHVybiAocmVxdWVzdDogUmVxdWVzdCwgY29udGV4dDogQ29udGV4dCkgPT4ge1xuLy8gICAgICAgaWYgKHJlcXVlc3QubWV0aG9kID09PSBtZXRob2QpIHtcbi8vICAgICAgICAgcmV0dXJuIGhhbmRsZXIocmVxdWVzdCwgY29udGV4dCk7XG4vLyAgICAgICB9XG4vLyAgICAgfTtcbi8vICAgfTtcbi8vIH07XG5cbi8vIGNvbnN0IGhhbmRsZVJlcXVlc3QgPSAocmVxdWVzdDogUmVxdWVzdCwgaGFuZGxlcjogUkhhbmRsZXIpID0+XG4vLyAgIGhhbmRsZXIocmVxdWVzdCwgbmV3IENvbnRleHQocmVxdWVzdCkpID8/XG4vLyAgICAgbmV3IFJlc3BvbnNlKFwiTm8gcm91dGVcIiwgeyBzdGF0dXM6IDQwNCB9KTtcblxuLy8gY29uc3QgY29tcG9zZSA9IDxUIGV4dGVuZHMgKChoYW5kbGVyOiBSSGFuZGxlcikgPT4gUkhhbmRsZXIpW10+KFxuLy8gICAuLi5oYW5kbGVyczogVFxuLy8gKSA9PiB7XG4vLyAgIHJldHVybiAoYTogUkhhbmRsZXIpID0+IGhhbmRsZXJzLnJlZHVjZSgocHJldiwgY3VycikgPT4gY3VycihwcmV2KSwgYSk7XG4vLyB9O1xuXG4vLyBjb25zdCBfcmVzID0gaGFuZGxlUmVxdWVzdChcbi8vICAgbmV3IFJlcXVlc3QoXCJodHRwczovL2xvY2FsaG9zdC9mb29cIiwgeyBtZXRob2Q6IFwiUE9TVFwiIH0pLFxuLy8gICBjb21wb3NlKG1ldGhvZChcIlBPU1RcIiksIHBhdHRlcm4oeyBwYXRobmFtZTogXCIvZm9vXCIgfSkpKGZvb0hhbmRsZXIpLFxuLy8gICAvL21ldGhvZChcIlBPU1RcIikocGF0dGVybih7IHBhdGhuYW1lOiBcIi94eHhcIiB9KShmb29IYW5kbGVyKSksXG4vLyApO1xuXG4vLyBjb25zb2xlLmxvZyhfcmVzKTtcblxuLy8gY29uc3QgcGF0aCA9IGRlZmluZSgocm91dGU6IFVSTFBhdHRlcm4sIGhhbmRsZXIpID0+IHtcbi8vICAgY29uc3QgcGF0dGVybiA9IG5ldyBVUkxQYXR0ZXJuKHJvdXRlKTtcbi8vICAgcmV0dXJuIChyZXF1ZXN0LCBjb250ZXh0KSA9PiB7XG4vLyAgICAgY29uc3QgbWF0Y2ggPSBwYXR0ZXJuLmV4ZWMocmVxdWVzdC51cmwpO1xuLy8gICAgIGlmIChtYXRjaCkge1xuLy8gICAgICAgY29udGV4dC5tYXRjaCA9IG1hdGNoO1xuXG4vLyAgICAgICByZXR1cm4gaGFuZGxlcihyZXF1ZXN0LCBjb250ZXh0KTtcbi8vICAgICB9XG4vLyAgIH07XG4vLyB9KTtcblxuLy8gY29uc29sZS5sb2coXG4vLyAgIGhhbmRsZXIuaGFuZGxlKFxuLy8gICAgIF9yZXF1ZXN0LFxuLy8gICAgIG5ldyBDb250ZXh0KF9yZXF1ZXN0KSxcbi8vICAgKSxcbi8vICk7XG4iXSwKICAibWFwcGluZ3MiOiAiOztBQUNBLFNBQVMsVUFBVSxpQkFBaUI7QUFDcEM7QUFBQSxFQUNFO0FBQUEsRUFDQTtBQUFBLEVBQ0E7QUFBQSxPQUNLO0FBU1AsT0FBTztBQThCQSxNQUFNLGtCQUdI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
